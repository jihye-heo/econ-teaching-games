<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Second Degree Price Discrimination Simulator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const AlertCircle = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        const TrendingUp = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const DollarSign = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
        );

        const Users = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        );

        const PriceDiscriminationSim = () => {
            const [scenario, setScenario] = useState('software');
            const [studentPrices, setStudentPrices] = useState({ basic: '', premium: '' });
            const [showResults, setShowResults] = useState(false);

            const scenarios = {
                software: {
                    name: "Cloud Storage Service",
                    description: "You're pricing a cloud storage service with two tiers",
                    customers: [
                        { id: 1, type: "Casual User", count: 3, basicWTP: 5, premiumWTP: 8, description: "Light users, mainly photos" },
                        { id: 2, type: "Professional", count: 2, basicWTP: 10, premiumWTP: 25, description: "Heavy users, need lots of space" }
                    ],
                    tiers: [
                        { name: "Basic", features: "100GB storage", optimalPrice: 5 },
                        { name: "Premium", features: "1TB storage + collaboration", optimalPrice: 20 }
                    ]
                },
                airline: {
                    name: "Airline Tickets",
                    description: "You're pricing airline tickets with advance purchase discounts",
                    customers: [
                        { id: 1, type: "Leisure Traveler", count: 4, basicWTP: 150, premiumWTP: 200, description: "Can book early, flexible dates" },
                        { id: 2, type: "Business Traveler", count: 2, basicWTP: 300, premiumWTP: 500, description: "Books last minute, values free cancellation/changes" }
                    ],
                    tiers: [
                        { name: "Early Bird", features: "Book 30+ days ahead, no changes", optimalPrice: 150 },
                        { name: "Flexible", features: "Book anytime, free changes", optimalPrice: 350 }
                    ]
                },
                coffee: {
                    name: "Coffee Shop",
                    description: "You're pricing coffee with size-based pricing",
                    customers: [
                        { id: 1, type: "Light Drinker", count: 5, basicWTP: 3, premiumWTP: 4, description: "Just needs caffeine fix" },
                        { id: 2, type: "Coffee Enthusiast", count: 3, basicWTP: 4, premiumWTP: 7, description: "Wants large premium drinks" }
                    ],
                    tiers: [
                        { name: "Small", features: "12oz regular coffee", optimalPrice: 3 },
                        { name: "Large Premium", features: "20oz specialty drink", optimalPrice: 6 }
                    ]
                }
            };

            const current = scenarios[scenario];

            const calculateRevenue = (basicPrice, premiumPrice) => {
                let revenue = 0;
                let choices = [];

                current.customers.forEach(segment => {
                    const basicSurplus = segment.basicWTP - basicPrice;
                    const premiumSurplus = segment.premiumWTP - premiumPrice;

                    if (premiumSurplus >= basicSurplus && premiumSurplus >= 0) {
                        revenue += segment.count * premiumPrice;
                        choices.push({ segment: segment.type, choice: "Premium", count: segment.count });
                    } else if (basicSurplus >= 0) {
                        revenue += segment.count * basicPrice;
                        choices.push({ segment: segment.type, choice: "Basic", count: segment.count });
                    } else {
                        choices.push({ segment: segment.type, choice: "None", count: segment.count });
                    }
                });

                return { revenue, choices };
            };

            const optimalRevenue = calculateRevenue(
                current.tiers[0].optimalPrice,
                current.tiers[1].optimalPrice
            );

            const studentRevenue = studentPrices.basic && studentPrices.premium
                ? calculateRevenue(parseFloat(studentPrices.basic), parseFloat(studentPrices.premium))
                : { revenue: 0, choices: [] };

            const handleSubmit = () => {
                if (studentPrices.basic && studentPrices.premium) {
                    setShowResults(true);
                }
            };

            const resetExercise = () => {
                setStudentPrices({ basic: '', premium: '' });
                setShowResults(false);
            };

            const efficiency = studentRevenue.revenue > 0 
                ? Math.round((studentRevenue.revenue / optimalRevenue.revenue) * 100) 
                : 0;

            const downloadCertificate = () => {
                const timestamp = new Date().toLocaleString();
                const content = `SECOND DEGREE PRICE DISCRIMINATION - COMPLETION CERTIFICATE
    
Scenario: ${current.name}
Date: ${timestamp}

Pricing Strategy:
- ${current.tiers[0].name}: $${studentPrices.basic}
- ${current.tiers[1].name}: $${studentPrices.premium}

Results:
${studentRevenue.choices.map(c => `- ${c.segment} (${c.count} customers): Chose ${c.choice}`).join('\n')}

Total Revenue: $${studentRevenue.revenue}
Optimal Revenue: $${optimalRevenue.revenue}
Efficiency: ${efficiency}%

Status: OPTIMAL SOLUTION ACHIEVED âœ“

This certificate confirms successful completion of the price discrimination exercise.
`;

                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `price-discrimination-certificate-${Date.now()}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                    <div className="max-w-5xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Second Degree Price Discrimination</h1>
                            <p className="text-gray-600 mb-6">Learn how firms use product versions and quantity discounts to extract consumer surplus without knowing individual preferences</p>
                            
                            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                                <div className="flex items-start">
                                    <AlertCircle size={20} className="text-blue-500 mr-3 flex-shrink-0 mt-1" />
                                    <div>
                                        <p className="text-sm text-gray-700"><strong>Key Concept:</strong> Unlike first degree (perfect) price discrimination, you don't know each customer's exact willingness to pay. Instead, you offer different tiers and let customers self-select!</p>
                                        <p className="text-sm text-gray-700 mt-2"><strong>Tie-breaking Rule:</strong> When customers are indifferent between two options (equal consumer surplus), assume they choose the higher quality/premium option.</p>
                                    </div>
                                </div>
                            </div>

                            <div className="mb-6">
                                <label className="block text-sm font-medium text-gray-700 mb-2">Choose a Scenario:</label>
                                <div className="grid grid-cols-3 gap-3">
                                    {Object.keys(scenarios).map(key => (
                                        <button
                                            key={key}
                                            onClick={() => {
                                                setScenario(key);
                                                resetExercise();
                                            }}
                                            className={`p-3 rounded-lg border-2 transition-all ${
                                                scenario === key 
                                                    ? 'border-blue-500 bg-blue-50 text-blue-700' 
                                                    : 'border-gray-200 hover:border-gray-300'
                                            }`}
                                        >
                                            {scenarios[key].name}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
                            <h2 className="text-2xl font-bold text-gray-800 mb-2">{current.name}</h2>
                            <p className="text-gray-600 mb-6">{current.description}</p>

                            <div className="grid md:grid-cols-2 gap-6 mb-6">
                                <div className="bg-purple-50 rounded-lg p-5">
                                    <div className="flex items-center mb-3">
                                        <Users size={24} className="text-purple-600 mr-2" />
                                        <h3 className="text-lg font-semibold text-gray-800">Customer Segments</h3>
                                    </div>
                                    {current.customers.map(customer => (
                                        <div key={customer.id} className="mb-4 pb-4 border-b last:border-b-0 border-purple-200">
                                            <div className="font-semibold text-gray-800 mb-1">
                                                {customer.type} <span className="text-sm text-gray-600">(n={customer.count})</span>
                                            </div>
                                            <div className="text-sm text-gray-600 mb-2">{customer.description}</div>
                                            <div className="text-sm">
                                                <span className="text-gray-700">WTP for {current.tiers[0].name}:</span> <span className="font-semibold text-green-700">${customer.basicWTP}</span>
                                            </div>
                                            <div className="text-sm">
                                                <span className="text-gray-700">WTP for {current.tiers[1].name}:</span> <span className="font-semibold text-green-700">${customer.premiumWTP}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <div className="bg-green-50 rounded-lg p-5">
                                    <div className="flex items-center mb-3">
                                        <DollarSign size={24} className="text-green-600 mr-2" />
                                        <h3 className="text-lg font-semibold text-gray-800">Product Tiers</h3>
                                    </div>
                                    {current.tiers.map((tier, idx) => (
                                        <div key={idx} className="mb-4 pb-4 border-b last:border-b-0 border-green-200">
                                            <div className="font-semibold text-gray-800 mb-1">{tier.name}</div>
                                            <div className="text-sm text-gray-600 mb-3">{tier.features}</div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Your Price:
                                                </label>
                                                <div className="flex items-center">
                                                    <span className="text-gray-600 mr-2">$</span>
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        min="0"
                                                        value={idx === 0 ? studentPrices.basic : studentPrices.premium}
                                                        onChange={(e) => {
                                                            const key = idx === 0 ? 'basic' : 'premium';
                                                            setStudentPrices({ ...studentPrices, [key]: e.target.value });
                                                            setShowResults(false);
                                                        }}
                                                        className="flex-1 border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                                        placeholder="Enter price"
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                    <button
                                        onClick={handleSubmit}
                                        disabled={!studentPrices.basic || !studentPrices.premium}
                                        className="w-full mt-4 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
                                    >
                                        Calculate Revenue
                                    </button>
                                </div>
                            </div>

                            {showResults && (
                                <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-6 border-2 border-indigo-200">
                                    <div className="flex items-center mb-4">
                                        <TrendingUp size={28} className="text-indigo-600 mr-2" />
                                        <h3 className="text-xl font-bold text-gray-800">Results</h3>
                                    </div>

                                    <div className="grid md:grid-cols-2 gap-6 mb-6">
                                        <div>
                                            <h4 className="font-semibold text-gray-800 mb-3">Customer Choices:</h4>
                                            {studentRevenue.choices.map((choice, idx) => (
                                                <div key={idx} className="flex items-center justify-between py-2 border-b border-gray-200">
                                                    <span className="text-gray-700">{choice.segment} ({choice.count})</span>
                                                    <span className={`font-semibold px-3 py-1 rounded ${
                                                        choice.choice === 'Premium' ? 'bg-purple-200 text-purple-800' :
                                                        choice.choice === 'Basic' ? 'bg-blue-200 text-blue-800' :
                                                        'bg-gray-200 text-gray-800'
                                                    }`}>
                                                        {choice.choice}
                                                    </span>
                                                </div>
                                            ))}
                                        </div>

                                        <div>
                                            <h4 className="font-semibold text-gray-800 mb-3">Revenue Analysis:</h4>
                                            <div className="space-y-3">
                                                <div className="flex justify-between items-center">
                                                    <span className="text-gray-700">Your Revenue:</span>
                                                    <span className="text-2xl font-bold text-indigo-600">${studentRevenue.revenue}</span>
                                                </div>
                                                <div className="flex justify-between items-center">
                                                    <span className="text-gray-700">Optimal Revenue:</span>
                                                    <span className="text-2xl font-bold text-green-600">${optimalRevenue.revenue}</span>
                                                </div>
                                                <div className="pt-3 border-t border-gray-300">
                                                    <div className="flex justify-between items-center mb-2">
                                                        <span className="text-gray-700 font-medium">Efficiency:</span>
                                                        <span className={`text-xl font-bold ${efficiency >= 90 ? 'text-green-600' : efficiency >= 70 ? 'text-yellow-600' : 'text-red-600'}`}>
                                                            {efficiency}%
                                                        </span>
                                                    </div>
                                                    <div className="w-full bg-gray-200 rounded-full h-3">
                                                        <div 
                                                            className={`h-3 rounded-full ${efficiency >= 90 ? 'bg-green-500' : efficiency >= 70 ? 'bg-yellow-500' : 'bg-red-500'}`}
                                                            style={{ width: `${efficiency}%` }}
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {efficiency === 100 ? (
                                        <div className="bg-green-100 border border-green-300 rounded-lg p-4">
                                            <p className="text-green-800 font-semibold mb-3">ðŸŽ‰ Perfect! You found the optimal pricing strategy!</p>
                                            <div className="text-sm text-green-700 space-y-3">
                                                <p className="font-semibold">Let's see why each customer chooses their tier:</p>
                                                
                                                {current.customers.map((customer, idx) => {
                                                    const basicPrice = parseFloat(studentPrices.basic);
                                                    const premiumPrice = parseFloat(studentPrices.premium);
                                                    const basicSurplus = customer.basicWTP - basicPrice;
                                                    const premiumSurplus = customer.premiumWTP - premiumPrice;
                                                    const isIndifferent = basicSurplus === premiumSurplus && basicSurplus >= 0;
                                                    const chosenTier = premiumSurplus >= basicSurplus && premiumSurplus >= 0 ? 'Premium' : (basicSurplus >= 0 ? 'Basic' : 'None');
                                                    
                                                    return (
                                                        <div key={idx} className="bg-white rounded p-3 border border-green-200">
                                                            <p className="font-semibold text-green-800 mb-2">{customer.type}:</p>
                                                            <div className="ml-3 space-y-1">
                                                                <p>
                                                                    â€¢ If they choose <span className="font-semibold">{current.tiers[0].name}</span>: Consumer Surplus = ${customer.basicWTP} - ${basicPrice} = 
                                                                    <span className={`font-bold ml-1 ${basicSurplus >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                                        ${basicSurplus.toFixed(2)}
                                                                    </span>
                                                                </p>
                                                                <p>
                                                                    â€¢ If they choose <span className="font-semibold">{current.tiers[1].name}</span>: Consumer Surplus = ${customer.premiumWTP} - ${premiumPrice} = 
                                                                    <span className={`font-bold ml-1 ${premiumSurplus >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                                        ${premiumSurplus.toFixed(2)}
                                                                    </span>
                                                                </p>
                                                                <p className="text-green-700 font-semibold mt-2">
                                                                    â†’ They choose <span className="underline">{chosenTier}</span> 
                                                                    {isIndifferent
                                                                        ? ' (indifferent, so choose premium by tie-breaking rule!)' 
                                                                        : ' (higher surplus!)'}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                                
                                                <p className="pt-2 font-semibold">
                                                    Result: Each segment self-selects into their intended tier and you capture maximum revenue!
                                                </p>
                                            </div>
                                            
                                            <button
                                                onClick={downloadCertificate}
                                                className="mt-4 w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors"
                                            >
                                                ðŸ“¥ Download Certificate
                                            </button>
                                        </div>
                                    ) : efficiency >= 70 ? (
                                        <div className="bg-yellow-100 border border-yellow-300 rounded-lg p-4">
                                            <p className="text-yellow-800 font-semibold">Good attempt! Here's a hint:</p>
                                            <p className="text-sm text-yellow-700 mt-2">
                                                {studentRevenue.revenue < optimalRevenue.revenue 
                                                    ? "Some customers aren't buying or are choosing suboptimal tiers. Think about how to make each customer type prefer exactly one tier. Consider: who has the lowest WTP for the basic tier? That might be your floor price."
                                                    : "You're close! Look at whether both customer segments are buying their most profitable options. Are high-value customers 'trading down' to the cheaper tier?"}
                                            </p>
                                        </div>
                                    ) : (
                                        <div className="bg-red-100 border border-red-300 rounded-lg p-4">
                                            <p className="text-red-800 font-semibold">Think about the self-selection principle:</p>
                                            <p className="text-sm text-red-700 mt-2">
                                                Ask yourself: (1) What's the maximum you can charge for {current.tiers[0].name} while still selling to {current.customers[0].type}? 
                                                (2) What's the maximum you can charge for {current.tiers[1].name} while ensuring {current.customers[1].type} prefers it over {current.tiers[0].name}? 
                                                Remember: each customer will choose the option that gives them the highest consumer surplus (WTP - Price).
                                            </p>
                                        </div>
                                    )}

                                    <button
                                        onClick={resetExercise}
                                        className="mt-4 w-full bg-gray-600 text-white py-2 rounded-lg font-semibold hover:bg-gray-700 transition-colors"
                                    >
                                        Try Again
                                    </button>
                                </div>
                            )}
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h3 className="text-lg font-bold text-gray-800 mb-3">Learning Points</h3>
                            <ul className="space-y-2 text-sm text-gray-700">
                                <li className="flex items-start">
                                    <span className="text-blue-600 mr-2 font-bold">â€¢</span>
                                    <span><strong>Self-Selection:</strong> Firms design product tiers so customers voluntarily choose the option that maximizes firm profit</span>
                                </li>
                                <li className="flex items-start">
                                    <span className="text-blue-600 mr-2 font-bold">â€¢</span>
                                    <span><strong>Quality Degradation:</strong> The basic tier is often deliberately limited to prevent high-value customers from buying it</span>
                                </li>
                                <li className="flex items-start">
                                    <span className="text-blue-600 mr-2 font-bold">â€¢</span>
                                    <span><strong>Incentive Compatibility:</strong> Each customer type must prefer their intended tier over the alternative</span>
                                </li>
                                <li className="flex items-start">
                                    <span className="text-blue-600 mr-2 font-bold">â€¢</span>
                                    <span><strong>Real Examples:</strong> Software pricing (basic/pro), airline tickets (economy/business), quantity discounts (bulk pricing)</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<PriceDiscriminationSim />, document.getElementById('root'));
    </script>
</body>
</html>